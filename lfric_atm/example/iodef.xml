<?xml version="1.0" encoding="UTF-8"?>
<simulation>

  <!-- In this version we have ONE context  -->

  <context id = "gungho_atm">

    <variable_definition src="../metadata/variable_def_main.xml"/>
    <axis_definition src="../metadata/axis_def_main.xml"/>
    <domain_definition src="../metadata/domain_def_main.xml"/>
    <grid_definition src="../metadata/grid_def_main.xml"/>

    <field_definition src="../metadata/lfric_dictionary.xml"/>

    <field_definition src="../metadata/field_def_diags.xml"/>
    <field_definition src="../metadata/field_def_initial_diags.xml"/>
    <field_definition src="../metadata/field_def_lbc_diags.xml"/>

    <field_definition prec="8" >

      <!-- Checkpoint group -->
      <field_group id="checkpoint_fields" freq_op="1ts" operation="once"  enabled=".FALSE." >
	<field id="checkpoint_theta" name="theta" long_name="air_potential_temperature" standard_name="air_potential_temperature" unit="K" domain_ref="checkpoint_Wtheta" />
	<field id="checkpoint_rho" name="rho" long_name="air_density" standard_name="air_density" unit="kg m-3" domain_ref="checkpoint_W3" />
	<field id="checkpoint_exner" name="exner" long_name="exner_pressure" unit="1" domain_ref="checkpoint_W3" />
	<field id="checkpoint_u" name="u" long_name="U" unit="m s-1" domain_ref="checkpoint_W2" />
	<field id="checkpoint_m_v" name="m_v" long_name="m_v" unit="kg kg-1" domain_ref="checkpoint_Wtheta" />
	<field id="checkpoint_m_cl" name="m_cl" long_name="m_cl" unit="kg kg-1" domain_ref="checkpoint_Wtheta" />
	<field id="checkpoint_m_r" name="m_r" long_name="m_r" unit="kg kg-1" domain_ref="checkpoint_Wtheta" />
	<field id="checkpoint_m_ci" name="m_ci" long_name="m_ci" unit="kg kg-1" domain_ref="checkpoint_Wtheta" />
	<field id="checkpoint_m_s" name="m_s" long_name="m_s" unit="kg kg-1" domain_ref="checkpoint_Wtheta" />
	<field id="checkpoint_m_g" name="m_g" long_name="m_g" unit="kg kg-1" domain_ref="checkpoint_Wtheta" />
	<field id="checkpoint_ageofair" name="ageofair" long_name="ageofair" unit="s" domain_ref="checkpoint_W3" />
      </field_group>
    </field_definition>

    <file_definition
	type="one_file"
	par_access="collective"
	time_counter="none">

      <!-- Checkpoint groups -->

      <!-- File definition for checkpoint write -->
      <file id="lfric_checkpoint_write" name="lfric_checkpoint_write" output_freq="1ts" convention="CF" enabled=".FALSE.">
        <field_group group_ref="checkpoint_fields" />
      </file>

      <!-- File definition for checkpoint read -->
      <file id="lfric_checkpoint_read" name="lfric_checkpoint_read" mode="read" output_freq="1ts" cyclic="true" enabled=".FALSE.">
	<field id="restart_theta" name="theta" long_name="air_potential_temperature" standard_name="air_potential_temperature" unit="K" operation="instant" domain_ref="checkpoint_Wtheta" />
	<field id="restart_exner" name="exner" long_name="exner_pressure" unit="1" operation="instant" domain_ref="checkpoint_W3" />
	<field id="restart_rho" name="rho" long_name="air_density" standard_name="air_density" unit="kg m-3" operation="instant" domain_ref="checkpoint_W3" />
	<field id="restart_u" name="u" long_name="U" unit="m s-1" operation="instant" domain_ref="checkpoint_W2" />
	<field id="restart_m_v" name="m_v" long_name="m_v" unit="kg kg-1" operation="instant" domain_ref="checkpoint_Wtheta" />
	<field id="restart_m_cl" name="m_cl" long_name="m_cl" unit="kg kg-1" operation="instant" domain_ref="checkpoint_Wtheta" />
	<field id="restart_m_r" name="m_r" long_name="m_r" unit="kg kg-1" operation="instant" domain_ref="checkpoint_Wtheta" />
	<field id="restart_m_ci" name="m_ci" long_name="m_ci" unit="kg kg-1" operation="instant" domain_ref="checkpoint_Wtheta" />
	<field id="restart_m_s" name="m_s" long_name="m_s" unit="kg kg-1" operation="instant" domain_ref="checkpoint_Wtheta" />
	<field id="restart_m_g" name="m_g" long_name="m_g" unit="kg kg-1" operation="instant" domain_ref="checkpoint_Wtheta" />
	<field id="restart_ageofair" name="ageofair" long_name="ageofair" unit="s" operation="instant" domain_ref="checkpoint_W3" />
      </file>

      <file id="lfric_diag" name="lfric_diag" output_freq="6h" convention="UGRID" enabled=".TRUE.">
	<field field_ref="theta" />
	<field field_ref="m_v" />
	<field field_ref="m_cl" />
	<field field_ref="processed__tot_col_m_cl" />
	<field field_ref="m_ci" />
	<field field_ref="m_r" />
	<field field_ref="rho" />
	<field field_ref="wetrho_in_w3" />
	<field field_ref="processed__pressure_in_w3" />
	<field field_ref="u_in_w3" />
	<field field_ref="v_in_w3" />
	<field field_ref="w_in_wth" />
	<field field_ref="radiation__sw_heating_rate" />
	<field field_ref="radiation__lw_heating_rate" />
	<field field_ref="radiation__sw_direct_toa" />
	<field field_ref="radiation__sw_up_toa" />
	<field field_ref="radiation__sw_up_clear_toa_rts" />
	<field field_ref="radiation__lw_up_toa" />
	<field field_ref="radiation__sw_down_surf" />
	<field field_ref="radiation__sw_up_surf" />
	<field field_ref="radiation__sw_up_clear_surf_rts" />
	<field field_ref="radiation__lw_down_surf" />
	<field field_ref="radiation__lw_up_surf" />
	<field field_ref="microphysics__ls_prec" />
	<field field_ref="processed__total_prec" />
	<field field_ref="cloud__bulk_fraction" />
	<field field_ref="cloud__combined_cloud_amount" />
	<field field_ref="cloud__cloud_amount_maxrnd" />
	<field field_ref="convection__conv_rain" />
	<field field_ref="convection__massflux_up" />
	<field field_ref="turbulence__zh" />
	<field field_ref="surface__tile_temperature" />
	<field field_ref="surface__grid_surface_temperature" />
	<field field_ref="surface__z0m" />
	<field field_ref="surface__grid_latent_heat" />
	<field field_ref="surface__tile_heat_flux" />
	<field field_ref="soil__soil_moisture" />
	<field field_ref="soil__unfrozen_soil_moisture" />
	<field field_ref="soil__soil_temperature" />
	<field field_ref="snow__grid_snow_mass" />
	<field field_ref="snow__snow_mass" />
	<field field_ref="snow__snow_depth" />
	<field field_ref="snow__tile_snow_rgrain" />
	<field field_ref="snow__snow_layer_temp" />
	<field field_ref="snow__snow_layer_thickness" />
	<field field_ref="snow__snow_layer_ice_mass" />
	<field field_ref="forcing__dtheta_force" />
	<field field_ref="forcing__dt_force" />
      </file>

      <file id="lfric_averages" name="lfric_averages" output_freq="12h" convention="UGRID" enabled=".TRUE.">
        <field field_ref="theta" operation="average" />
        <field field_ref="exner" operation="average" />
        <field field_ref="u_in_w3" operation="average" />
        <field field_ref="v_in_w3" operation="average" />
        <field field_ref="w_in_wth" operation="average" />
      </file>

      <file id="lfric_initial" name="lfric_initial" output_freq="1ts" convention="UGRID" enabled=".TRUE.">
	<field_group operation="once" freq_op="1ts">
	  <field field_ref="init_theta" />
	  <field field_ref="init_m_v" />
	  <field field_ref="init_m_cl" />
	  <field field_ref="init_m_ci" />
	  <field field_ref="init_m_r" />
	  <field field_ref="init_w_in_wth" />
	  <field field_ref="init_rho" />
	  <field field_ref="init_exner" />
	  <field field_ref="init_height_w3" />
	  <field field_ref="init_height_wth" />
	</field_group>
      </file>

      <!-- File definition for writing an FD dump -->
      <file id="lfric_fd_dump" name="lfric_fd_dump" output_freq="1ts" convention="UGRID" enabled=".FALSE." >
      </file>

      <!-- File definition for reading in from a UM2LFRic FD UGRID format dump  -->
      <file id="read_lfric_fd_dump" name="lfric_fd_dump" mode="read" output_freq="1ts" convention="UGRID" cyclic="false" enabled=".FALSE.">
      </file>

    </file_definition>

  </context>

  <context id = "xios">
    <variable_definition>
      <variable_group id = "buffer">
        <variable id = "optimal_buffer_size" type = "string" >performance</variable>
        <variable id = "buffer_factor_size" type = "double" >1.0</variable>
      </variable_group>

      <variable_group id = "parameters" >
        <variable id = "using_server" type = "bool" >true</variable>
        <variable id = "info_level" type = "int" >50</variable>
        <variable id = "print_file" type="bool">true</variable>
      </variable_group>
    </variable_definition>
  </context>

</simulation>
